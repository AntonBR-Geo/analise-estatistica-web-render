<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados da An√°lise - Completo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .card { margin-bottom: 1.5rem; }
        .table-responsive { max-height: 500px; }
        .img-fluid { max-width: 100%; height: auto; }
        .nav-tabs .nav-link.active { font-weight: bold; background-color: #fff; }
        .small-table { font-size: 0.875rem; }
        .math-table th { background-color: #e9ecef; }
        .tab-pane { padding-top: 1rem; }
        .badge-numero { background-color: #0d6efd; }
        .variaveis-lista { max-height: 300px; overflow-y: auto; }
        .export-card { transition: transform 0.2s; }
        .export-card:hover { transform: translateY(-5px); }
    </style>
</head>
<body>
    <div class="container-fluid mt-3">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1>üìä Resultados da An√°lise Estat√≠stica Completa</h1>
                    <a href="/" class="btn btn-outline-primary">‚Üê Nova An√°lise</a>
                </div>

                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="variaveis-tab" data-bs-toggle="tab" 
                                data-bs-target="#variaveis" type="button" role="tab">
                            üìã Vari√°veis
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="estatisticas-tab" data-bs-toggle="tab" 
                                data-bs-target="#estatisticas" type="button" role="tab">
                            üìà Estat√≠sticas
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="normalidade-tab" data-bs-toggle="tab" 
                                data-bs-target="#normalidade" type="button" role="tab">
                            üìä Normalidade
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="correlacao-tab" data-bs-toggle="tab" 
                                data-bs-target="#correlacao" type="button" role="tab">
                            üîó Correla√ß√£o
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="variancia-tab" data-bs-toggle="tab" 
                                data-bs-target="#variancia" type="button" role="tab">
                            üìä Vari√¢ncia Explicada
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="cargas-tab" data-bs-toggle="tab" 
                                data-bs-target="#cargas" type="button" role="tab">
                            üéØ Cargas Fatoriais
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="transformacao-tab" data-bs-toggle="tab" 
                                data-bs-target="#transformacao" type="button" role="tab">
                            üîÑ Matriz Transforma√ß√£o
                        </button>
                    </li>
                    <!-- NOVA ABA: Exportar -->
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="exportar-tab" data-bs-toggle="tab" 
                                data-bs-target="#exportar" type="button" role="tab">
                            üíæ Exportar
                        </button>
                    </li>
                </ul>

                <div class="tab-content" id="myTabContent">
                    
                    <!-- Aba: Vari√°veis -->
                    <div class="tab-pane fade show active" id="variaveis" role="tabpanel">
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header bg-success text-white">
                                        <h5>‚úÖ Vari√°veis Inclu√≠das na An√°lise</h5>
                                        <small class="text-white-50">{{ resultados.variaveis_numericas|length }} vari√°veis selecionadas</small>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-sm table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>#</th>
                                                        <th>Vari√°vel</th>
                                                        <th>Tipo</th>
                                                        <th>Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for var in resultados.variaveis_numericas %}
                                                    <tr>
                                                        <td><span class="badge badge-numero">{{ loop.index }}</span></td>
                                                        <td><strong>{{ var }}</strong></td>
                                                        <td><span class="badge bg-success">Num√©rica</span></td>
                                                        <td><span class="badge bg-primary">Inclu√≠da</span></td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="mt-3">
                                            <h6>üìù Informa√ß√µes:</h6>
                                            <ul class="small">
                                                <li><strong>Total de vari√°veis analisadas:</strong> {{ resultados.variaveis_numericas|length }}</li>
                                                <li><strong>Observa√ß√µes v√°lidas:</strong> {{ resultados.fatorial.n_observacoes }}</li>
                                                <li><strong>M√©todo de rota√ß√£o:</strong> {{ resultados.fatorial.rotacao|title }}</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header bg-secondary text-white">
                                        <h5>üìù Vari√°veis N√£o Inclu√≠das</h5>
                                        {% if resultados.variaveis_nao_selecionadas %}
                                        <small class="text-white-50">{{ resultados.variaveis_nao_selecionadas|length }} vari√°veis dispon√≠veis</small>
                                        {% endif %}
                                    </div>
                                    <div class="card-body">
                                        {% if resultados.variaveis_nao_selecionadas %}
                                        <div class="variaveis-lista">
                                            <table class="table table-sm table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Vari√°vel</th>
                                                        <th>Tipo</th>
                                                        <th>Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for var in resultados.variaveis_nao_selecionadas %}
                                                    <tr>
                                                        <td>{{ var }}</td>
                                                        <td><span class="badge bg-success">Num√©rica</span></td>
                                                        <td><span class="badge bg-secondary">N√£o selecionada</span></td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                        {% else %}
                                        <div class="text-center py-4">
                                            <div class="text-muted">
                                                <h6>üéâ Todas as vari√°veis inclu√≠das!</h6>
                                                <p class="mb-0">Todas as vari√°veis num√©ricas dispon√≠veis foram selecionadas para an√°lise.</p>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>

                                <!-- Resumo da An√°lise -->
                                <div class="card mt-3">
                                    <div class="card-header bg-info text-white">
                                        <h5>‚ÑπÔ∏è Resumo da An√°lise</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row text-center">
                                            <div class="col-md-6 mb-3">
                                                <div class="card bg-light">
                                                    <div class="card-body py-3">
                                                        <h3 class="text-primary mb-0">{{ resultados.fatorial.n_fatores }}</h3>
                                                        <small class="text-muted">Fatores Extra√≠dos</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <div class="card bg-light">
                                                    <div class="card-body py-3">
                                                        <h3 class="text-success mb-0">{{ resultados.fatorial.n_observacoes }}</h3>
                                                        <small class="text-muted">Observa√ß√µes</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <h6>üìä Adequa√ß√£o dos Dados:</h6>
                                            <ul class="small mb-0">
                                                <li><strong>KMO:</strong> {{ "%.3f"|format(resultados.kmo_bartlett.KMO_Geral) }}</li>
                                                <li><strong>Teste de Bartlett:</strong> 
                                                    <span class="badge bg-{{ 'success' if resultados.kmo_bartlett.Bartlett_Significativo else 'warning' }}">
                                                        {{ 'Significativo' if resultados.kmo_bartlett.Bartlett_Significativo else 'N√£o Significativo' }}
                                                    </span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Estat√≠sticas Descritivas -->
                    <div class="tab-pane fade" id="estatisticas" role="tabpanel">
                        <!-- Conte√∫do existente da aba Estat√≠sticas -->
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>üì¶ Boxplot das Vari√°veis Selecionadas</h5>
                                    </div>
                                    <div class="card-body">
                                        <img src="data:image/png;base64,{{ resultados.boxplot }}" class="img-fluid" alt="Boxplot">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>üìà Estat√≠sticas Descritivas</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-sm">
                                                <thead>
                                                    <tr>
                                                        <th>Vari√°vel</th>
                                                        <th>M√©dia</th>
                                                        <th>Mediana</th>
                                                        <th>DP</th>
                                                        <th>Assimetria</th>
                                                        <th>N</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for stat in resultados.estatisticas %}
                                                    <tr>
                                                        <td><small>{{ stat.Vari√°vel }}</small></td>
                                                        <td>{{ "%.3f"|format(stat.M√©dia) }}</td>
                                                        <td>{{ "%.3f"|format(stat.Mediana) }}</td>
                                                        <td>{{ "%.3f"|format(stat['Desvio Padr√£o']) }}</td>
                                                        <td>{{ "%.3f"|format(stat['Assimetria (Skewness)']) }}</td>
                                                        <td>{{ stat.N }}</td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Estat√≠sticas Detalhadas -->
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>üìã Estat√≠sticas Descritivas Completas</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-sm small-table">
                                                <thead>
                                                    <tr>
                                                        <th>Vari√°vel</th>
                                                        <th>M√©dia</th>
                                                        <th>Mediana</th>
                                                        <th>DP</th>
                                                        <th>Vari√¢ncia</th>
                                                        <th>Assimetria</th>
                                                        <th>Curtose</th>
                                                        <th>M√≠nimo</th>
                                                        <th>M√°ximo</th>
                                                        <th>Q1</th>
                                                        <th>Q3</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for stat in resultados.estatisticas %}
                                                    <tr>
                                                        <td><small>{{ stat.Vari√°vel }}</small></td>
                                                        <td>{{ "%.3f"|format(stat.M√©dia) }}</td>
                                                        <td>{{ "%.3f"|format(stat.Mediana) }}</td>
                                                        <td>{{ "%.3f"|format(stat['Desvio Padr√£o']) }}</td>
                                                        <td>{{ "%.3f"|format(stat.Vari√¢ncia) }}</td>
                                                        <td>{{ "%.3f"|format(stat['Assimetria (Skewness)']) }}</td>
                                                        <td>{{ "%.3f"|format(stat['Curtose (Kurtosis)']) }}</td>
                                                        <td>{{ "%.3f"|format(stat.M√≠nimo) }}</td>
                                                        <td>{{ "%.3f"|format(stat.M√°ximo) }}</td>
                                                        <td>{{ "%.3f"|format(stat.Q1) }}</td>
                                                        <td>{{ "%.3f"|format(stat.Q3) }}</td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Testes de Normalidade -->
                    <div class="tab-pane fade" id="normalidade" role="tabpanel">
                        <!-- Conte√∫do existente da aba Normalidade -->
                        <div class="card mt-3">
                            <div class="card-header">
                                <h5>üìä Testes de Normalidade</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Vari√°vel</th>
                                                <th>Shapiro-Wilk (Estat√≠stica)</th>
                                                <th>Shapiro-Wilk (p-valor)</th>
                                                <th>Normal SW</th>
                                                <th>K-S (Estat√≠stica)</th>
                                                <th>K-S (p-valor)</th>
                                                <th>Normal K-S</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for teste in resultados.normalidade %}
                                            <tr>
                                                <td>{{ teste.Vari√°vel }}</td>
                                                <td>{{ "%.4f"|format(teste['Shapiro-Wilk (Estat√≠stica)']) }}</td>
                                                <td>{{ "%.4f"|format(teste['Shapiro-Wilk (p-valor)']) }}</td>
                                                <td>
                                                    <span class="badge bg-{{ 'success' if teste['Shapiro-Wilk (Normal)'] else 'danger' }}">
                                                        {{ 'Sim' if teste['Shapiro-Wilk (Normal)'] else 'N√£o' }}
                                                    </span>
                                                </td>
                                                <td>{{ "%.4f"|format(teste['Kolmogorov-Smirnov (Estat√≠stica)']) }}</td>
                                                <td>{{ "%.4f"|format(teste['Kolmogorov-Smirnov (p-valor)']) }}</td>
                                                <td>
                                                    <span class="badge bg-{{ 'success' if teste['Kolmogorov-Smirnov (Normal)'] else 'danger' }}">
                                                        {{ 'Sim' if teste['Kolmogorov-Smirnov (Normal)'] else 'N√£o' }}
                                                    </span>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="row mt-4">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>üìù Interpreta√ß√£o Shapiro-Wilk</h6>
                                            </div>
                                            <div class="card-body">
                                                <ul class="small">
                                                    <li><strong>H‚ÇÄ:</strong> Os dados seguem distribui√ß√£o normal</li>
                                                    <li><strong>p-valor > 0.05:</strong> N√£o rejeita H‚ÇÄ (normal)</li>
                                                    <li><strong>p-valor ‚â§ 0.05:</strong> Rejeita H‚ÇÄ (n√£o normal)</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>üìù Interpreta√ß√£o Kolmogorov-Smirnov</h6>
                                            </div>
                                            <div class="card-body">
                                                <ul class="small">
                                                    <li>Compara distribui√ß√£o emp√≠rica com normal te√≥rica</li>
                                                    <li>Mais sens√≠vel a diferen√ßas nas caudas da distribui√ß√£o</li>
                                                    <li>Recomendado para amostras maiores (>50)</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Correla√ß√£o -->
                    <div class="tab-pane fade" id="correlacao" role="tabpanel">
                        <!-- Conte√∫do existente da aba Correla√ß√£o -->
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>üîó Matriz de Correla√ß√£o - Heatmap</h5>
                                    </div>
                                    <div class="card-body">
                                        <img src="data:image/png;base64,{{ resultados.correlacao.heatmap }}" class="img-fluid" alt="Heatmap Correla√ß√£o">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>üìä Testes KMO e Bartlett</h5>
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-bordered">
                                            <tr>
                                                <th class="bg-light">Teste de Esfericidade de Bartlett</th>
                                                <td>{{ "%.4f"|format(resultados.kmo_bartlett.Bartlett_p_valor) }}</td>
                                                <td>
                                                    <span class="badge bg-{{ 'success' if resultados.kmo_bartlett.Bartlett_Significativo else 'danger' }}">
                                                        {{ 'Significativo' if resultados.kmo_bartlett.Bartlett_Significativo else 'N√£o Significativo' }}
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th class="bg-light">KMO Geral</th>
                                                <td colspan="2">{{ "%.4f"|format(resultados.kmo_bartlett.KMO_Geral) }}</td>
                                            </tr>
                                        </table>
                                        
                                        <div class="mt-4">
                                            <h6>üìà KMO por Vari√°vel:</h6>
                                            <div class="table-responsive">
                                                <table class="table table-sm table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>Vari√°vel</th>
                                                            <th>KMO</th>
                                                            <th>Adequa√ß√£o</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for var_name, kmo_value in resultados.kmo_bartlett.KMO_Variaveis.items() %}
                                                        <tr>
                                                            <td>{{ var_name }}</td>
                                                            <td>{{ "%.4f"|format(kmo_value) }}</td>
                                                            <td>
                                                                {% if kmo_value >= 0.8 %}
                                                                <span class="badge bg-success">Excelente</span>
                                                                {% elif kmo_value >= 0.7 %}
                                                                <span class="badge bg-primary">Boa</span>
                                                                {% elif kmo_value >= 0.6 %}
                                                                <span class="badge bg-warning">Regular</span>
                                                                {% else %}
                                                                <span class="badge bg-danger">Ruim</span>
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        
                                        <div class="alert alert-info mt-3">
                                            <h6>üí° Interpreta√ß√£o KMO:</h6>
                                            <ul class="mb-0 small">
                                                <li><strong>> 0.9:</strong> Maravilhoso</li>
                                                <li><strong>0.8 - 0.9:</strong> Merit√≥rio</li>
                                                <li><strong>0.7 - 0.8:</strong> M√©dio</li>
                                                <li><strong>0.6 - 0.7:</strong> Med√≠ocre</li>
                                                <li><strong>< 0.6:</strong> Inaceit√°vel</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                   					
						<!-- MAtriz anti-imagem -->
						<div class="row mt-4">
							<div class="col-md-6">
								<div class="card">
									<div class="card-header" style="background-color: #2F4F4F; color: white;">
										<h5>üîÑ Matriz de Correla√ß√£o Anti-Imagem</h5>
										<small class="text-warning">Correla√ß√µes Parciais (controle para outras vari√°veis)</small>
									</div>
									<div class="card-body">
										<img src="data:image/png;base64,{{ resultados.fatorial.heatmap_anti_imagem }}" class="img-fluid" alt="Heatmap Anti-Imagem">
									</div>
								</div>
							</div>
							<div class="col-md-6">
								<div class="card">
									<div class="card-header" style="background-color: #2F4F4F; color: white;">
										<h5>üìñ Interpreta√ß√£o da Matriz Anti-Imagem</h5>
									</div>
									<div class="card-body">
										<h6>üéØ O que √© a Matriz Anti-Imagem?</h6>
										<p class="small">
											A <strong>matriz anti-imagem</strong> mostra as <strong>correla√ß√µes parciais</strong> entre cada par de vari√°veis, 
											<strong>controlando pelo efeito das demais vari√°veis</strong> no conjunto de dados.
										</p>
                
										<h6>üìä Como interpretar:</h6>
										<ul class="small">
											<li><strong>Valores pr√≥ximos de 0:</strong> Correla√ß√£o parcial fraca</li>
											<li><strong>Valores positivos altos:</strong> Forte correla√ß√£o positiva direta</li>
											<li><strong>Valores negativos altos:</strong> Forte correla√ß√£o negativa direta</li>
											<li><strong>Diagonal principal:</strong> Representa a adequa√ß√£o de cada vari√°vel (n√£o mostrada no gr√°fico)</li>
										</ul>
                
										<h6>üîç Uso na An√°lise Fatorial:</h6>
										<ul class="small">
											<li>Identifica rela√ß√µes <strong>diretas</strong> entre vari√°veis</li>
											<li>Ajuda a detectar <strong>multicolinearidade</strong></li>
											<li>Complementa a an√°lise da matriz de correla√ß√£o de Pearson</li>
											<li>Valores altos sugerem que as vari√°veis compartilham vari√¢ncia √∫nica</li>
										</ul>
                
										<div class="alert alert-warning mt-3">
											<h6>üí° Dica Importante:</h6>
											<p class="small mb-0">
												Compare com a matriz de correla√ß√£o regular. Se os padr√µes forem similares, 
												as correla√ß√µes s√£o robustas. Se diferirem muito, pode indicar rela√ß√µes esp√∫rias.
											</p>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Matriz Anti-Imagem - Vers√£o Corrigida -->
						<div class="row mt-4">
							<div class="col-12">
								<div class="card">
									<div class="card-header">
										<h5>Matriz de Correla√ß√£o Anti-Imagem</h5>
										<small>Diagonal principal mostra a Medida de Adequa√ß√£o da Amostra (MAS) para cada vari√°vel</small>
									</div>
									<div class="card-body">
										<div class="table-responsive">
										<table class="table table-bordered table-sm">
												<thead>
													<tr>
														<th>Vari√°vel</th>
														{% for var in resultados.variaveis_numericas %}
														<th class="text-center">{{ var }}</th>
														{% endfor %}
													</tr>
												</thead>
												<tbody>
													{% for i in range(resultados.variaveis_numericas|length) %}
													<tr>
														<td><strong>{{ resultados.variaveis_numericas[i] }}</strong></td>
														{% for j in range(resultados.variaveis_numericas|length) %}
														{% set valor = resultados.fatorial.matriz_anti_imagem[i, j] %}
														{% if i == j %}
														<td class="text-center bg-info text-white">
															<strong>{{ "%.3f"|format(valor) }}</strong>
														</td>
														{% else %}
														<td class="text-center">
															{{ "%.3f"|format(valor) }}
														</td>
														{% endif %}
														{% endfor %}
													</tr>
													{% endfor %}
												</tbody>
											</table>
										</div>
										<div class="mt-3">
											<small class="text-muted">
												<strong>üí° Interpreta√ß√£o:</strong><br>
												<strong>Diagonal (MAS):</strong> Valores entre 0-1. >0.8 = Excelente, 0.7-0.8 = Bom, 0.6-0.7 = Regular, <0.5 = Ruim<br>
												<strong>Fora da diagonal:</strong> Correla√ß√µes parciais entre vari√°veis (controlando outras vari√°veis)
											</small>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

                    <!-- Vari√¢ncia Explicada -->
                    <div class="tab-pane fade" id="variancia" role="tabpanel">
                        <!-- Conte√∫do existente da aba Vari√¢ncia -->
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>üìä Scree Plot</h5>
                                    </div>
                                    <div class="card-body">
                                        <img src="data:image/png;base64,{{ resultados.fatorial.scree_plot }}" class="img-fluid" alt="Scree Plot">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>‚ÑπÔ∏è Informa√ß√µes da An√°lise Fatorial</h5>
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-sm">
                                            <tr>
                                                <th class="bg-light">N√∫mero de Fatores:</th>
                                                <td><strong>{{ resultados.fatorial.n_fatores }}</strong></td>
                                            </tr>
                                            <tr>
                                                <th class="bg-light">M√©todo de Rota√ß√£o:</th>
                                                <td><strong>{{ resultados.fatorial.rotacao|title }}</strong></td>
                                            </tr>
                                            <tr>
                                                <th class="bg-light">N√∫mero de Vari√°veis:</th>
                                                <td>{{ resultados.fatorial.n_variaveis }}</td>
                                            </tr>
                                            <tr>
                                                <th class="bg-light">N√∫mero de Observa√ß√µes:</th>
                                                <td>{{ resultados.fatorial.n_observacoes }}</td>
                                            </tr>
                                            <tr>
                                                <th class="bg-light">Itera√ß√µes para Converg√™ncia:</th>
                                                <td>{{ resultados.fatorial.n_iteracoes }}</td>
                                            </tr>
                                        </table>
                                        
                                        <div class="alert alert-success mt-3">
                                            <h6>üéØ Crit√©rio de Kaiser:</h6>
                                            <p class="mb-0">Fatores com autovalor > 1 foram retidos para an√°lise.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>üìà Vari√¢ncia Total Explicada - Solu√ß√£o Inicial</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-sm small-table math-table">
                                                <thead>
                                                    <tr>
                                                        <th>Fator</th>
                                                        <th>Autovalor</th>
                                                        <th>% Vari√¢ncia</th>
                                                        <th>% Acumulado</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for i in range(resultados.fatorial.n_fatores) %}
                                                    <tr>
                                                        <td><strong>{{ i+1 }}</strong></td>
                                                        <td>{{ "%.3f"|format(resultados.fatorial.variancia_inicial.autovalores[i]) }}</td>
                                                        <td>{{ "%.3f"|format(resultados.fatorial.variancia_inicial.percentual[i]) }}%</td>
                                                        <td>{{ "%.3f"|format(resultados.fatorial.variancia_inicial.acumulado[i]) }}%</td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>üìä Vari√¢ncia Total Explicada - Solu√ß√£o Rotacionada</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-sm small-table math-table">
                                                <thead>
                                                    <tr>
                                                        <th>Fator</th>
                                                        <th>Soma Quadrados</th>
                                                        <th>% Vari√¢ncia</th>
                                                        <th>% Acumulado</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for i in range(resultados.fatorial.n_fatores) %}
                                                    <tr>
                                                        <td><strong>{{ i+1 }}</strong></td>
                                                        <td>{{ "%.3f"|format(resultados.fatorial.variancia_rotacionada.soma_quadrados[i]) }}</td>
                                                        <td>{{ "%.3f"|format(resultados.fatorial.variancia_rotacionada.percentual[i]) }}%</td>
                                                        <td>{{ "%.3f"|format(resultados.fatorial.variancia_rotacionada.acumulado[i]) }}%</td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cargas Fatoriais -->
                    <div class="tab-pane fade" id="cargas" role="tabpanel">
                        <!-- Conte√∫do existente da aba Cargas -->
                        <div class="card mt-3">
                            <div class="card-header">
                                <h5>üéØ Matriz de Cargas Fatoriais Rotacionadas</h5>
                                <small>Rotated Factor Matrix - {{ resultados.fatorial.rotacao|title }}</small>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-sm small-table math-table">
                                        <thead>
                                            <tr>
                                                <th>Vari√°vel</th>
                                                {% for i in range(resultados.fatorial.n_fatores) %}
                                                <th class="text-center">Fator {{ i+1 }}</th>
                                                {% endfor %}
                                                <th class="text-center">Comunalidade</th>
                                                <th class="text-center">Singularidade</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for var_name in resultados.variaveis_numericas %}
                                            <tr>
                                                <td><strong>{{ var_name }}</strong></td>
                                                {% for i in range(resultados.fatorial.n_fatores) %}
                                                {% set carga = resultados.fatorial.cargas_rotacionadas.loc[var_name, 'Fator_' ~ (i+1)|string] %}
                                                <td class="text-center {{ 'table-primary' if carga|abs >= 0.5 else '' }}">
                                                    {{ "%.3f"|format(carga) }}
                                                    {% if carga|abs >= 0.5 %}
                                                    <span class="badge bg-success ms-1">‚óè</span>
                                                    {% endif %}
                                                </td>
                                                {% endfor %}
                                                <td class="text-center">{{ "%.3f"|format(resultados.fatorial.comunalidades.loc[var_name, 'Extra√ß√£o']) }}</td>
                                                <td class="text-center">{{ "%.3f"|format(resultados.fatorial.comunalidades.loc[var_name, 'Singularidade']) }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="row mt-4">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>üìù Interpreta√ß√£o das Cargas</h6>
                                            </div>
                                            <div class="card-body">
                                                <ul class="small">
                                                    <li><span class="badge bg-success">‚óè</span> Carga significativa (‚â• |0.5|)</li>
                                                    <li><strong>Comunalidade:</strong> Vari√¢ncia explicada pelos fatores</li>
                                                    <li><strong>Singularidade:</strong> Vari√¢ncia n√£o explicada (1 - Comunalidade)</li>
                                                    <li><strong>Comunalidade > 0.6:</strong> Boa representa√ß√£o pelo modelo</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>‚öôÔ∏è Informa√ß√µes T√©cnicas</h6>
                                            </div>
                                            <div class="card-body">
                                                <ul class="small mb-0">
                                                    <li><strong>M√©todo de Extra√ß√£o:</strong> An√°lise de Componentes Principais</li>
                                                    <li><strong>M√©todo de Rota√ß√£o:</strong> {{ resultados.fatorial.rotacao|title }}</li>
                                                    <li><strong>Crit√©rio de Reten√ß√£o:</strong> Autovalor > 1 (Kaiser)</li>
                                                    <li><strong>Comunalidade M√©dia:</strong> {{ "%.3f"|format(resultados.fatorial.comunalidades['Extra√ß√£o'].mean()) }}</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Matriz de Transforma√ß√£o -->
                    <div class="tab-pane fade" id="transformacao" role="tabpanel">
                        <!-- Conte√∫do existente da aba Transforma√ß√£o -->
                        <div class="card mt-3">
                            <div class="card-header">
                                <h5>üîÑ Matriz de Transforma√ß√£o de Componentes</h5>
                                <small>Component Transformation Matrix - {{ resultados.fatorial.rotacao|title }}</small>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <strong>üìñ Interpreta√ß√£o:</strong> Esta matriz mostra como os componentes iniciais s√£o transformados nos componentes rotacionados.
                                    A matriz de transforma√ß√£o T satisfaz: <em>A<sub>rotacionada</sub> = A<sub>inicial</sub> √ó T</em>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped table-sm small-table math-table">
                                        <thead>
                                            <tr>
                                                <th>Componente</th>
                                                {% for i in range(resultados.fatorial.n_fatores) %}
                                                <th class="text-center">Fator {{ i+1 }}</th>
                                                {% endfor %}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for i in range(resultados.fatorial.n_fatores) %}
                                            <tr>
                                                <td><strong>Fator {{ i+1 }}</strong></td>
                                                {% for j in range(resultados.fatorial.n_fatores) %}
                                                <td class="text-center">{{ "%.4f"|format(resultados.fatorial.matriz_transformacao.iloc[i, j]) }}</td>
                                                {% endfor %}
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <div class="mt-3">
                                    <h6>üìö Notas T√©cnicas:</h6>
                                    <ul class="small">
                                        {% if resultados.fatorial.rotacao in ['varimax', 'quartimax', 'equamax'] %}
                                        <li>Para rota√ß√µes ortogonais ({{ resultados.fatorial.rotacao|title }}): A matriz de transforma√ß√£o √© ortogonal (T √ó T' = I)</li>
                                        {% else %}
                                        <li>Para rota√ß√µes obl√≠quas ({{ resultados.fatorial.rotacao|title }}): A matriz mostra as correla√ß√µes entre os fatores</li>
                                        {% endif %}
                                        <li>Os valores representam os coeficientes para transformar os fatores iniciais em fatores rotacionados</li>
                                        <li>Esta matriz √© usada para calcular os scores fatoriais rotacionados</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- NOVA ABA: Exportar Resultados -->
                    <div class="tab-pane fade" id="exportar" role="tabpanel">
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="card border-0">
                                    <div class="card-header bg-success text-white text-center py-4">
                                        <h2 class="mb-2"><i class="fas fa-download"></i></h2>
                                        <h4 class="mb-0">Exportar Resultados Completos</h4>
                                        <p class="mb-0 mt-2">Baixe todos os resultados para uso em outros softwares ou relat√≥rios</p>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-4">
                                            <!-- CSV -->
                                            <div class="col-md-4">
                                                <div class="card h-100 export-card border-primary">
                                                    <div class="card-body text-center p-4">
                                                        <div class="mb-3">
                                                            <i class="fas fa-file-csv fa-3x text-primary"></i>
                                                        </div>
                                                        <h5 class="card-title text-primary">CSV Completo</h5>
                                                        <p class="card-text text-muted">
                                                            Todos os resultados em arquivos CSV organizados (ZIP)
                                                        </p>
                                                        <form action="/exportar_csv" method="post" class="mt-3">
                                                            <input type="hidden" name="session_id" value="{{ resultados.session_id }}">
                                                            <button type="submit" class="btn btn-outline-primary btn-lg">
                                                                <i class="fas fa-download"></i> Baixar ZIP
                                                            </button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Excel -->
                                            <div class="col-md-4">
                                                <div class="card h-100 export-card border-success">
                                                    <div class="card-body text-center p-4">
                                                        <div class="mb-3">
                                                            <i class="fas fa-file-excel fa-3x text-success"></i>
                                                        </div>
                                                        <h5 class="card-title text-success">Excel Completo</h5>
                                                        <p class="card-text text-muted">
                                                            Planilha com m√∫ltiplas abas organizadas e formatadas
                                                        </p>
                                                        <form action="/exportar_excel" method="post" class="mt-3">
                                                            <input type="hidden" name="session_id" value="{{ resultados.session_id }}">
                                                            <button type="submit" class="btn btn-outline-success btn-lg">
                                                                <i class="fas fa-download"></i> Baixar Excel
                                                            </button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- PDF -->
                                            <div class="col-md-4">
                                                <div class="card h-100 export-card border-danger">
                                                    <div class="card-body text-center p-4">
                                                        <div class="mb-3">
                                                            <i class="fas fa-file-pdf fa-3x text-danger"></i>
                                                        </div>
                                                        <h5 class="card-title text-danger">Relat√≥rio PDF</h5>
                                                        <p class="card-text text-muted">
                                                            Relat√≥rio profissional formatado para impress√£o e apresenta√ß√£o
                                                        </p>
                                                        <form action="/exportar_pdf" method="post" class="mt-3">
                                                            <input type="hidden" name="session_id" value="{{ resultados.session_id }}">
                                                            <button type="submit" class="btn btn-outline-danger btn-lg">
                                                                <i class="fas fa-download"></i> Baixar PDF
                                                            </button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Conte√∫do Inclu√≠do -->
                                        <div class="card mt-5">
                                            <div class="card-header bg-info text-white">
                                                <h6 class="mb-0"><i class="fas fa-list-check"></i> Conte√∫do Inclu√≠do na Exporta√ß√£o</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <ul class="list-group list-group-flush">
                                                            <li class="list-group-item">‚úÖ Estat√≠sticas Descritivas</li>
                                                            <li class="list-group-item">‚úÖ Testes de Normalidade</li>
                                                            <li class="list-group-item">‚úÖ Matriz de Correla√ß√£o</li>
                                                            <li class="list-group-item">‚úÖ Cargas Fatoriais</li>
                                                        </ul>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <ul class="list-group list-group-flush">
                                                            <li class="list-group-item">‚úÖ Comunalidades</li>
                                                            <li class="list-group-item">‚úÖ Scores Fatoriais</li>
                                                            <li class="list-group-item">‚úÖ Matriz de Transforma√ß√£o</li>
                                                            <li class="list-group-item">‚úÖ Resumo da An√°lise</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

				</div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Ativar todas as abas corretamente
        var triggerTabList = [].slice.call(document.querySelectorAll('#myTab button'))
        triggerTabList.forEach(function (triggerEl) {
            var tabTrigger = new bootstrap.Tab(triggerEl)
            triggerEl.addEventListener('click', function (event) {
                event.preventDefault()
                tabTrigger.show()
            })
        })
    </script>
</body>
</html>