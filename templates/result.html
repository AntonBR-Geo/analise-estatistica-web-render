<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Resultados da An√°lise</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .card { box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15); margin-bottom: 2rem; }
        img { max-width: 100%; height: auto; margin: 1rem 0; border: 1px solid #dee2e6; border-radius: 8px; }
        .table { margin: 1rem 0; background: white; }
        .table thead th { background-color: #f8f9fa; font-weight: bold; }
        .table-success { background-color: #d1e7dd !important; }
        .table-danger { background-color: #f8d7da !important; }
        .card-header { font-weight: bold; }
        .btn-secondary { background-color: #6c757d; border: none; }
        .btn-secondary:hover { background-color: #5a6268; }
        .form-check-inline { margin-right: 15px; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <a href="/" class="btn btn-secondary mb-4 px-4 py-2">
            ‚¨ÖÔ∏è Voltar
        </a>
        <h1 class="text-center mb-5">üìà Resultados da An√°lise Estat√≠stica</h1>

        <!-- Estat√≠stica Descritiva -->
        <div class="card">
            <div class="card-header bg-info text-white">
                <h3 class="mb-0">üìã Estat√≠stica Descritiva</h3>
            </div>
            <div class="card-body">
                {{ results.descritiva|safe }}
            </div>
        </div>

        <!-- Boxplots -->
        {% if results.boxplot %}
            {% for boxplot_url in results.boxplot %}
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h3 class="mb-0">üì¶ Boxplots das Vari√°veis</h3>
                </div>
                <div class="card-body text-center">
                    <img src="{{ boxplot_url | safe }}" alt="Boxplots das vari√°veis" class="img-fluid">
                </div>
            </div>
            {% endfor %}
        {% endif %}

        <!-- Testes de Normalidade -->
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h3 class="mb-0">üìà Testes de Normalidade</h3>
            </div>
            <div class="card-body">
                <table class="table table-bordered table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Vari√°vel</th>
                            <th>Shapiro (Estat)</th>
                            <th>Shapiro (p)</th>
                            <th>Normal?</th>
                            <th>K-S (Estat)</th>
                            <th>K-S (p)</th>
                            <th>Normal?</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in results.normalidade %}
                        <tr>
                            <td>{{ item.variavel }}</td>
                            <td>{{ item.shapiro_stat }}</td>
                            <td>{{ item.shapiro_p }}</td>
                            <td class="{{ 'table-success' if item.shapiro_normal == 'Sim' else 'table-danger' }}">{{ item.shapiro_normal }}</td>
                            <td>{{ item.ks_stat }}</td>
                            <td>{{ item.ks_p }}</td>
                            <td class="{{ 'table-success' if item.ks_normal == 'Sim' else 'table-danger' }}">{{ item.ks_normal }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Matriz de Correla√ß√£o -->
        {% if results.correlacao_img %}
        <div class="card">
            <div class="card-header bg-success text-white">
                <h3 class="mb-0">üîó Matriz de Correla√ß√£o</h3>
            </div>
            <div class="card-body text-center">
                <img src="{{ results.correlacao_img | safe }}" alt="Matriz de Correla√ß√£o" class="img-fluid">
                <h4 class="mt-4 mb-3">Tabela de Coeficientes de Correla√ß√£o</h4>
                {{ results.correlacao_table|safe }}
            </div>
        </div>
        {% endif %}

        <!-- Teste KMO -->
        <div class="card">
            <div class="card-header bg-info text-white">
                <h3 class="mb-0">üß™ Kaiser-Meyer-Olkin (KMO)</h3>
            </div>
            <div class="card-body">
                <table class="table table-bordered table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Vari√°vel</th>
                            <th>MSA</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if 'error' in results.kmo %}
                        <tr>
                            <td colspan="2" class="text-danger text-center fw-bold">{{ results.kmo.error }}</td>
                        </tr>
                        {% else %}
                        <tr class="table-active">
                            <td><strong>Overall MSA</strong></td>
                            <td><strong>{{ results.kmo.overall_msa }}</strong></td>
                        </tr>
                        {% for index, (var, msa) in results.kmo.indexed_vars %}
                        <tr>
                            <td>{{ var }}</td>
                            <td>{{ msa }}</td>
                        </tr>
                        {% endfor %}
                        {% endif %}
                    </tbody>
                </table>
                <div class="alert alert-info mt-3">
                    <small><strong>üìå Interpreta√ß√£o:</strong> Valores < 0,5 s√£o inadequados para an√°lise fatorial. Ideal: > 0,6.</small>
                </div>
            </div>
        </div>

        <!-- Teste Bartlett -->
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h3 class="mb-0">üß™ Teste de Esfericidade de Bartlett</h3>
            </div>
            <div class="card-body">
                <table class="table table-bordered table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Qui-Quadrado (œá¬≤)</th>
                            <th>Graus de Liberdade (df)</th>
                            <th>p-valor</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if 'error' in results.bartlett %}
                        <tr>
                            <td colspan="3" class="text-danger text-center fw-bold">{{ results.bartlett.error }}</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td>{{ results.bartlett.chi2 }}</td>
                            <td>{{ results.bartlett.df }}</td>
                            <td class="{{ 'table-success' if results.bartlett.p < '0,05' else 'table-danger' }}">{{ results.bartlett.p }}</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
                <div class="alert alert-warning mt-3">
                    <small><strong>üìå Interpreta√ß√£o:</strong> Se p < 0,05 ‚Üí rejeita H‚ÇÄ ‚Üí h√° correla√ß√µes significativas ‚Üí adequado para an√°lise fatorial.</small>
                </div>
            </div>
        </div>

        <!-- PCA -->
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">üìä An√°lise de Componentes Principais (PCA)</h3>
            </div>
            <div class="card-body">
                {% if 'error' in results.pca %}
                    <div class="alert alert-danger">
                        <strong>Erro na PCA:</strong> {{ results.pca.error }}
                    </div>
                {% else %}
                    <!-- Gr√°fico de Escarpa -->
                    <div class="text-center mb-4">
                        <img src="{{ results.pca.scree_plot | safe }}" alt="Gr√°fico de Escarpa" class="img-fluid">
                        <p class="mt-2"><em>Autovalores > 1 indicam componentes significativos.</em></p>
                    </div>

                    <!-- Vari√¢ncia Total Explicada -->
                    <div class="mb-4">
                        <h5>üìà Vari√¢ncia Total Explicada</h5>
                        <table class="table table-bordered table-sm">
                            <thead>
                                <tr>
                                    <th rowspan="2">Componente</th>
                                    <th colspan="3">Solu√ß√£o Inicial</th>
                                    <th colspan="3">Solu√ß√£o Rotacionada</th>
                                </tr>
                                <tr>
                                    <th>Autovalor</th>
                                    <th>% Vari√¢ncia</th>
                                    <th>% Cumulativa</th>
                                    <th>Suma de Quadrados</th>
                                    <th>% Vari√¢ncia</th>
                                    <th>% Cumulativa</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for i in range(results.pca.n_components) %}
                                <tr>
                                    <td>{{ i+1 }}</td>
                                    <!-- Solu√ß√£o Inicial -->
                                    <td>{{ results.pca.eigenvalues[i] }}</td>
                                    <td>{{ results.pca.variance_explained[i] }}</td>
                                    <td>{{ results.pca.cumulative_variance[i] }}</td>
                                    <!-- Solu√ß√£o Rotacionada -->
                                    <td>{{ results.pca.rotated_sum_squares[i] }}</td>
                                    <td>{{ results.pca.rotated_variance_explained[i] }}</td>
                                    <td>{{ results.pca.rotated_cumulative_variance[i] }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Matriz de Componente Rotativa -->
                    <div class="mb-4">
                        <h5>üß© Matriz de Componente Rotativa ({{ results.pca.rotation_method }})</h5>
                        <table class="table table-bordered table-sm">
                            <thead>
                                <tr>
                                    <th>Vari√°vel</th>
                                    {% for i in range(results.pca.n_components) %}
                                        <th>Comp {{ i+1 }}</th>
                                    {% endfor %}
                                    <th>Comunalidades</th>
                                    <th>Singularidades</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for i in range(results.pca.rotated_loadings|length) %}
                                <tr>
                                    <td>{{ results.pca.var_names[i] }}</td>
                                    {% for j in range(results.pca.n_components) %}
                                        <td>{{ results.pca.rotated_loadings[i][j] }}</td>
                                    {% endfor %}
                                    <td>{{ results.pca.communalities[i] }}</td>
                                    <td>{{ results.pca.uniquenesses[i] }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <p class="text-muted"><small>Rota√ß√£o convergida em {{ results.pca.n_iterations }} itera√ß√µes (m√°x. 25).</small></p>
                    </div>

                    <!-- Matriz de Transforma√ß√£o de Componente -->
                    <div class="mb-4">
                        <h5>‚öôÔ∏è Matriz de Transforma√ß√£o de Componente</h5>
                        <p><small>Mostra como os componentes originais foram transformados para gerar os componentes rotacionados.</small></p>
                        {% if results.pca.transformation_matrix %}
                            <table class="table table-bordered table-sm">
                                <thead>
                                    <tr>
                                        <th>Comp Original</th>
                                        {% for i in range(results.pca.n_components) %}
                                            <th>Comp Rot {{ i+1 }}</th>
                                        {% endfor %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for i in range(results.pca.n_components) %}
                                    <tr>
                                        <td>{{ i+1 }}</td>
                                        {% for j in range(results.pca.n_components) %}
                                            <td>{{ results.pca.transformation_matrix[i][j] }}</td>
                                        {% endfor %}
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <p class="text-muted">Matriz de transforma√ß√£o n√£o dispon√≠vel.</p>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
	
		<!-- Rean√°lise Interativa -->
        <a href="/" class="btn btn-secondary mb-4">‚¨ÖÔ∏è Clique para nova an√°lise</a>

    </div>
</body>
</html>